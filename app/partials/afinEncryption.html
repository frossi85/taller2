<!DOCTYPE html>
<html>
<body>

<p>Ejecución de algoritmo Afin</p>

<form action="demo_form.asp">
Mensaje: <input type="text" name="Mensaje" value="hola" id="mensaje"><br>
Clave A: <input type="text" name="ClaveA" value="9" id="A"><br>
Clave B: <input type="text" name="ClaveB" value="4" id="B"><br>
</form>

<p></p>

<button onclick="ejecutar()">Ejecutar</button>

<script>

var z26 = ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];


function paso1(input){
	
	var indice
	console.log("Paso 1" +"<br>");	
	for	(indice = 0; indice < z26.length; indice++) {
		if(z26[indice] == input){
			console.log("Resultado " + indice +"<br>");	
			return indice;
		}
	}

}

function paso2(input,A){
	
	console.log("Paso 2" + "<br>");
	
	var resultado2 = input*A;

	console.log("Resultado = " + resultado2 +"<br>");
	return resultado2;

}

function paso3(input,B){

	console.log("Paso 3" + "<br>");
	
	var resultado3 = input+B;

	console.log("Resultado = " + resultado3 +"<br>");
	return resultado3;

}

function paso4(input){

	console.log("Paso 4" + "<br>");
	
	var resultado4 = input%26;

	console.log("Resultado = " + resultado4 +"<br>");
	return resultado4;

}

function paso5(input){

	console.log("Paso 5" + "<br>");
	
	resultado5 = z26[input];

	console.log("Resultado = " + resultado5 +"<br>");
	return resultado5;

}


function findGCD( l1, l2) {

    if(l2 == 0){
        return l1;
    }
    return findGCD(l2, l1%l2);
}

function verificar(A,B){

	//Se verifican que A y B sean numeros
	if(isNaN(A) == true){
		document.write("La clave A ingresada no es un número"+"<br>");
		return 1;
	}

	if(isNaN(B) == true){
		document.write("La clave B ingresada no es un número"+"<br>");
		return 1;
	}

	//Se verifica que A sea != 1
	if( A == 1 || A > 26){
		document.write("La clave A debe ser un número distinto a 1"+"<br>");
		return 1;
		
	}

	//Se verifica que 1<=B<=26
	if( B > 26 || B < 1){
		document.write("La clave B debe ser un número entre 1 y 26"+"<br>");
		return 1;
		
	}		

	// Se verifican que los numeros sean coprimos
	if(findGCD(A,B) != 1){
		document.write("La clave no esta formada por numeros coprimos. Los coprimos validos son 1, 2, 3, 5, 7, 11, 13, 17, 19, 23"+"<br>");
		return 1;
	}
	
	return 0;
}


function ejecutar(){

	var mensaje = document.getElementById('mensaje').value;
	var A = parseInt(document.getElementById('A').value);
	var B = parseInt(document.getElementById('B').value);
	var text = "<ul>";
	var cifrado = "";
	var index;
	var iter;


	if (verificar(A,B) == 0){	

		document.write("El mensaje original es: " + mensaje +"<br>");

		for	(index = 0; index < mensaje.length; index++) {

			if(mensaje.charAt(index) != " "){

				iter = index + 1;	
				console.log("Iteración Nro: " + iter +"<br>"+"<br>");

				var resultado1 = paso1(mensaje.charAt(index));
				var resultado2 = paso2(resultado1,A);
				var resultado3 = paso3(resultado2,B);
				var resultado4 = paso4(resultado3);
				var resultado5 = paso5(resultado4);

			}
			else{
				resultado5 = " ";
			}
			cifrado+= resultado5;

			console.log(mensaje.charAt(index));
		}

		document.write("<br>"+"El mensaje crifrado es: " + cifrado);
	}
	else{
		document.write("<br>"+"Error de datos ingresados. Por favor, ingrese valores correctos para la clave");
	}
}


</script> 

</body>
</html>